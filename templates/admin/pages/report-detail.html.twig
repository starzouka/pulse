{% extends 'admin/base_admin.html.twig' %}

{% block title %}PULSE - Detail signalement{% endblock %}

{% block admin_content %}
  <div class="pageHeader">
    <div>
      <h2>Detail signalement #{{ report.reportId }}</h2>
      <div class="pageSub">Mise a jour et apercu cible.</div>
    </div>
    <div class="formActions">
      <a class="btn btnGhost" href="{{ path('admin_reports') }}">Retour liste</a>
    </div>
  </div>

  {% for label, messages in app.flashes %}
    {% for message in messages %}
      <div class="listItem">
        <span>{{ message }}</span>
        <span class="badge {{ label == 'error' ? 'badge--danger' : 'badge--success' }}">{{ label|upper }}</span>
      </div>
    {% endfor %}
  {% endfor %}

  <section class="panel">
    <div class="panelHeader">
      <h3 class="panelTitle">EDITER LE SIGNALEMENT</h3>
    </div>

    {{ form_start(reportForm, {attr: {novalidate: 'novalidate'}}) }}
      {% include 'admin/pages/_report_form_fields.html.twig' with {form: reportForm} %}
      <div class="formActions" style="margin-top:12px;">
        <button class="btn btnPrimary" type="submit">Mettre a jour</button>
      </div>
    {{ form_end(reportForm) }}
  </section>

  <section class="panel">
    <div class="panelHeader">
      <h3 class="panelTitle">APERÇU CIBLE</h3>
    </div>

    <div class="list">
      <div class="listItem"><span>target_type</span><span class="listMeta">{{ targetType }}</span></div>
      <div class="listItem"><span>target_id</span><span class="listMeta">{{ report.targetId }}</span></div>

      {% if targetEntity %}
        {% if targetType == 'POST' %}
          <div class="listItem"><span>Post</span><span class="listMeta">{{ targetEntity.contentText ? targetEntity.contentText|slice(0, 100) : '-' }}</span></div>
          <div class="listItem"><span>Action</span><span class="listMeta"><a class="btn btnTiny" href="{{ path('admin_post_detail', {id: targetEntity.postId}) }}">Voir post</a></span></div>
        {% elseif targetType == 'COMMENT' %}
          <div class="listItem"><span>Commentaire</span><span class="listMeta">{{ targetEntity.contentText ? targetEntity.contentText|slice(0, 100) : '-' }}</span></div>
          <div class="listItem"><span>Action</span><span class="listMeta"><a class="btn btnTiny" href="{{ path('admin_comments', {edit: targetEntity.commentId}) }}">Voir commentaire</a></span></div>
        {% elseif targetType == 'USER' %}
          <div class="listItem"><span>User</span><span class="listMeta">{{ targetEntity.username }} ({{ targetEntity.email }})</span></div>
          <div class="listItem"><span>Action</span><span class="listMeta"><a class="btn btnTiny" href="{{ path('admin_user_detail', {id: targetEntity.userId}) }}">Voir utilisateur</a></span></div>
        {% elseif targetType == 'TEAM' %}
          <div class="listItem"><span>Team</span><span class="listMeta">{{ targetEntity.name }}</span></div>
          <div class="listItem"><span>Action</span><span class="listMeta"><a class="btn btnTiny" href="{{ path('admin_team_detail', {id: targetEntity.teamId}) }}">Voir equipe</a></span></div>
        {% endif %}
      {% else %}
        <div class="listItem"><span>Cible</span><span class="listMeta">Objet cible introuvable.</span></div>
      {% endif %}
    </div>
  </section>
{% endblock %}