{% extends 'base.html.twig' %}

{% block title %}PULSE - Mes tournois{% endblock %}

{% block body %}
  {% include 'front/partials/_hero_mini.html.twig' with {
    hero_kicker: 'ORGANISATEUR',
    hero_title: 'Mes tournois',
    hero_sub: 'Tournois valides, ouverts ou en cours.',
    breadcrumb_current: 'Mes tournois'
  } %}

  <main class="page">
    <section class="belowHero">
      <div class="layout">
        {% include 'front/partials/_organizer_side_nav.html.twig' with {active: 'tournaments'} %}

        <div>
          {% for label, messages in app.flashes %}
            {% for message in messages %}
              <div class="listItem">
                <span>{{ message }}</span>
                <span class="badge {{ label == 'error' ? 'badge--danger' : 'badge--success' }}">{{ label|upper }}</span>
              </div>
            {% endfor %}
          {% endfor %}

          <div class="panel">
            <div class="panel__head">
              <h3 class="panel__title">MES TOURNOIS</h3>
              <div class="panel__desc">Total: {{ counter|default(tournaments|length) }} tournoi(s)</div>
            </div>

            <form method="get" action="{{ path('front_organizer_tournaments') }}">
              <div class="filtersRow">
                <input class="input" type="search" name="q" value="{{ filters.q|default('') }}" placeholder="Rechercher un tournoi..." />

                <div class="select">
                  <select name="status">
                    <option value="">Statut</option>
                    {% for statusValue in statusOptions %}
                      <option value="{{ statusValue }}" {{ filters.status == statusValue ? 'selected' : '' }}>{{ statusValue }}</option>
                    {% endfor %}
                  </select>
                </div>

                <div class="select">
                  <select name="game">
                    <option value="">Jeu</option>
                    {% for game in availableGames %}
                      <option value="{{ game.gameId }}" {{ filters.game is not null and filters.game == game.gameId ? 'selected' : '' }}>{{ game.name }}</option>
                    {% endfor %}
                  </select>
                </div>

                <div class="select">
                  <select name="sort">
                    {% for sortValue in sortOptions %}
                      <option value="{{ sortValue }}" {{ filters.sort == sortValue ? 'selected' : '' }}>{{ sortValue|upper }}</option>
                    {% endfor %}
                  </select>
                </div>

                <button class="btn btn--primary" type="submit">Filtrer</button>
                <a class="btn btn--ghost" href="{{ path('front_organizer_tournaments') }}">Reset</a>
              </div>
            </form>

            <div class="tableWrap">
              <table class="table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Tournoi</th>
                    <th>Jeu</th>
                    <th>Statut</th>
                    <th>Equipes inscrites</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  {% for tournament in tournaments %}
                    {% set statusClass = tournament.status == 'OPEN'
                      ? 'badge--success'
                      : (tournament.status == 'ONGOING' ? 'badge--info' : (tournament.status == 'CANCELLED' ? 'badge--danger' : ''))
                    %}
                    <tr>
                      <td>#{{ tournament.tournamentId }}</td>
                      <td>{{ tournament.title }}</td>
                      <td>{{ tournament.gameId ? tournament.gameId.name : '-' }}</td>
                      <td><span class="badge {{ statusClass }}">{{ tournament.status }}</span></td>
                      <td>{{ registrationsByTournamentId[tournament.tournamentId] ?? 0 }}</td>
                      <td>
                        <a class="btn btn--ghost" href="{{ path('front_organizer_tournament_detail', {id: tournament.tournamentId}) }}">Gerer</a>
                      </td>
                    </tr>
                  {% else %}
                    <tr>
                      <td colspan="6" class="muted">Aucun tournoi pour le moment.</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>

          <div class="panel">
            <div class="panel__head">
              <div>
                <h3 class="panel__title">TABLES UTILISEES</h3>
                <div class="panel__desc">Donnees extraites depuis le schema reel.</div>
              </div>
            </div>
            <div class="list">
              <div class="listItem">
                <span><b>tournaments</b></span>
                <span class="listItem__meta">tournament_id, organizer_user_id, game_id, title, status, photo_path</span>
              </div>
              <div class="listItem">
                <span><b>tournament_teams</b></span>
                <span class="listItem__meta">tournament_id, team_id, status, registered_at</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      {% include 'front/partials/_footer.html.twig' %}
    </section>
  </main>

  {% include 'front/partials/_auth_modal.html.twig' %}
{% endblock %}

