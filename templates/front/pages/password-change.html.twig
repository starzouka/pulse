{% extends 'base.html.twig' %}

{% block title %}PULSE - Changer mot de passe{% endblock %}

{% block body %}
  {% include 'front/partials/_hero_mini.html.twig' with {
    hero_kicker: 'JOUEUR',
    hero_title: 'Changer mot de passe',
    hero_sub: 'Securisez votre session active.',
    breadcrumb_current: 'Changer mot de passe'
  } %}

  <main class="page">
    <section class="belowHero">
      <div class="layout">
        {% include 'front/partials/_player_side_nav.html.twig' with { active: 'profile_edit' } %}

        <div class="socialShell">
          <div class="socialStack">
            {% for label, messages in app.flashes %}
              {% for message in messages %}
                <div class="listItem">
                  <span>{{ message }}</span>
                  <span class="badge {{ label == 'error' ? 'badge--danger' : 'badge--success' }}">{{ label|upper }}</span>
                </div>
              {% endfor %}
            {% endfor %}

            {{ form_start(passwordChangeForm, {attr: {class: 'panel gadget', novalidate: 'novalidate'}}) }}
              <h3 class="panel__title">MISE A JOUR MOT DE PASSE</h3>
              <div class="formGrid">
                <label class="field">
                  <span class="field__label">Ancien mot de passe</span>
                  {{ form_widget(passwordChangeForm.currentPassword, {attr: {class: 'input'}}) }}
                  {{ form_errors(passwordChangeForm.currentPassword) }}
                </label>

                <label class="field">
                  <span class="field__label">Nouveau mot de passe</span>
                  {{ form_widget(passwordChangeForm.plainPassword.first, {attr: {class: 'input'}}) }}
                  {{ form_errors(passwordChangeForm.plainPassword.first) }}
                </label>

                <label class="field">
                  <span class="field__label">Confirmation</span>
                  {{ form_widget(passwordChangeForm.plainPassword.second, {attr: {class: 'input'}}) }}
                  {{ form_errors(passwordChangeForm.plainPassword.second) }}
                </label>
              </div>

              <div class="formActions" style="margin-top:12px;">
                <button class="btn btn--primary" type="submit">Mettre a jour</button>
                <a class="btn btn--ghost" href="{{ path('front_profile') }}">Retour profil</a>
              </div>
            {{ form_end(passwordChangeForm) }}
          </div>

          <aside class="socialStack">
            <section class="panel gadget gadget--alert">
              <h3 class="panel__title">SECURITE</h3>
              <div class="list">
                <div class="listItem"><span>Session actuelle</span><span class="badge badge--success">ACTIVE</span></div>
                <div class="listItem"><span>Email verifie</span><span class="listItem__meta">{{ viewer_user.emailVerified ? 'Oui' : 'Non' }}</span></div>
                <div class="listItem"><span>Derniere connexion</span><span class="listItem__meta">{{ viewer_user.lastLoginAt ? viewer_user.lastLoginAt|date('d/m/Y H:i') : 'N/A' }}</span></div>
              </div>
            </section>
          </aside>
        </div>
      </div>

      {% include 'front/partials/_footer.html.twig' %}
    </section>
  </main>

  {% include 'front/partials/_auth_modal.html.twig' %}
{% endblock %}
